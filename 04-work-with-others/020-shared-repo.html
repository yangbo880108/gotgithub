

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.2. 共享版本库 &mdash; GotGitHub</title>
    
    <link rel="stylesheet" href="../static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/master.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" />
    <link rel="stylesheet" href="../static/worldhello.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/translations.js"></script>
    <link rel="top" title="GotGitHub" href="../index.html" />
    <link rel="up" title="4. 工作协同" href="index.html" />
    <link rel="next" title="4.3. 组织和团队" href="030-organization.html" />
    <link rel="prev" title="4.1. Fork + Pull模式" href="010-fork-and-pull.html" /> 
  </head>
  <body>
    <div id='header'>
      <h1><a href='/'>World Hello</a></h1>

      <div id='menu'>
        <ul>
          <li><a href='/' id='home-link' title='Home'>首页</a></li>
          <li><a href='/blog.html' id='blog-link' title='Blog'>博客</a></li>
          <li><a href='/doc/' id='docs-link' title='Docs'>文章</a></li>
          <li><a href='/about.html' id='about-link' title='About'>关于</a></li>
          <li><a href='http://github.com/gotgit' target='_blank' title='GitHub' rel='me' id='github-link'>GitHub</a></li>
          <li><a href='http://weibo.com/gotgit' title='微博' target='_blank' id='weibo-link'>微博</a></li>
        </ul>
      </div>
    </div>

    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="030-organization.html" title="4.3. 组织和团队"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="010-fork-and-pull.html" title="4.1. Fork + Pull模式"
             accesskey="P">上一页</a> |</li>
        <li><a href="../index.html">GotGitHub</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">4. 工作协同</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.2. 共享版本库</a><ul>
<li><a class="reference internal" href="#collaborators">4.2.1. 版本库授权</a></li>
<li><a class="reference internal" href="#central-model">4.2.2. 与传统集中式工作模式的异同</a></li>
<li><a class="reference internal" href="#merge-and-push">4.2.3. 合并后推送</a></li>
<li><a class="reference internal" href="#rebase-and-push">4.2.4. 合并还是变基</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="010-fork-and-pull.html"
                        title="上一章">4.1. Fork + Pull模式</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="030-organization.html"
                        title="下一章">4.3. 组织和团队</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/04-work-with-others/020-shared-repo.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="shared-repo">
<span id="id1"></span><h1>4.2. 共享版本库<a class="headerlink" href="#shared-repo" title="永久链接至标题">¶</a></h1>
<p>除了独具特色的“Fork + Pull”的分布式工作模式，GitHub同样支持传统的集中式协同工作模式。</p>
<div class="section" id="collaborators">
<span id="id2"></span><h2>4.2.1. 版本库授权<a class="headerlink" href="#collaborators" title="永久链接至标题">¶</a></h2>
<p>GitHub可以通过多种途径为版本库授权，让版本库成为多人共享的版本库，从而让项目管理者围绕项目创建一个核心开发团队。下面以gotgithub账号下的helloworld版本库为例，介绍如何设置版本库的多人共享。</p>
<p>进入<tt class="docutils literal"><span class="pre">gotgithub/helloworld</span></tt>项目的管理界面，点击左侧导航条中的“Collaborators”，可以查看及添加项目的合作者，如图4-17所示。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/collaborators.png"><img alt="../images/collaborators.png" src="../images/collaborators.png" /></a>
<p class="caption">图4-17：添加项目合作者</p>
</div>
<p>图4-17为项目添加了两个合作者：supergirl和incredible。添加到项目当中的合作者会收到通知邮件，告知已经被加入到相应的项目当中。当新加入的项目合作者，如incredible，登录GitHub，在仪表板的版本库列表中会看到源自gotgithub用户的版本库，如图4-18所示。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/prj-list-of-collab.png"><img alt="../images/prj-list-of-collab.png" src="../images/prj-list-of-collab.png" /></a>
<p class="caption">图4-18：合作者项目列表</p>
</div>
<p>从图4-18可以看出GitHub用户incredible自己创建的项目托管在自己的空间下，而作为合作者参与的项目仍然托管在原创建者（gotgithub）的空间下，这一点明显和派生（Fork）而来的项目不同。图4-19是以incredible登录GitHub访问<tt class="docutils literal"><span class="pre">gotgithub/helloworld</span></tt>的界面。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/collab-view-helloworld.png"><img alt="../images/collab-view-helloworld.png" src="../images/collab-view-helloworld.png" /></a>
<p class="caption">图4-19：以合作者身份访问项目</p>
</div>
<p>用户incredible对版本库<tt class="docutils literal"><span class="pre">gotgithub/helloworld</span></tt>拥有写入权限。和<tt class="docutils literal"><span class="pre">gotgithub</span></tt>用户稍有区别的是没有管理员权限。</p>
</div>
<div class="section" id="central-model">
<span id="id3"></span><h2>4.2.2. 与传统集中式工作模式的异同<a class="headerlink" href="#central-model" title="永久链接至标题">¶</a></h2>
<p>传统的集中式版本控制系统，如CVS、SVN，所有用户都访问同一个版本库。采用集中式工作模式的GitHub用户也同样是访问同一版本库。</p>
<p>对于由用户gotgithub创建的<tt class="docutils literal"><span class="pre">helloworld</span></tt>版本库，添加了合作者supergirl和incredible，三个人克隆版本库使用如下命令。</p>
<ul>
<li><p class="first">用户 gotgithub 克隆版本库。</p>
<div class="highlight-python"><pre>gotgithub$ git clone https://gotgithub@github.com/gotgithub/helloworld.git</pre>
</div>
</li>
<li><p class="first">用户 supergirl 克隆版本库。</p>
<div class="highlight-python"><pre>supergirl$ git clone https://supergirl@github.com/gotgithub/helloworld.git</pre>
</div>
</li>
<li><p class="first">用户 incredible 克隆版本库。</p>
<div class="highlight-python"><pre>incredible$ git clone https://incredible@github.com/gotgithub/helloworld.git</pre>
</div>
</li>
</ul>
<p>传统集中式版本控制系统，所有的提交历史数据都在唯一的版本库中，各个提交是顺序进行的。为了防止多用户在提交时相互覆盖，集中式版本控制系统发明了很多方法 。有的采用编辑锁的形式（如VSS），更改文件前对文件锁定，其他人禁止对文件进行访问（甚至无法读取），完成修改并提交后，文件解锁。有的如SVN，允许多人同时编辑同一文件，但只有先进行提交的才能成功，后提交的会遇到“过时”错误，必须先获取版本库中的新增提交并和本地修改进行合并。即传统集中式版本控制系统，提交时必须和唯一的版本库所在的服务器保持连接，而且提交有可能会失败。</p>
<p>对于像Git这样的分布式版本控制系统，提交总是会成功，这是因为提交并不涉及和共享服务器的交互，是针对本地克隆版本库进行的本地操作。采用集中式的工作模式，共享版本库作为各个用户各自本地版本库数据交换、沟通的中介，只有在本地克隆版本库需要和共享版本库同步的时候才要和服务器建立连接。例如将本地所做的一个或多个提交推送到共享服务器，或者将服务器上新的提交获取到本地克隆版本库。</p>
<p>实际上无论采用分布式还是集中式的工作模式，Git都好像工作在一个独立的分支上（克隆即分支），即使共享版本库和本地克隆版本库的分支名都叫做<tt class="docutils literal"><span class="pre">master</span></tt>。如图4-20，三个用户克隆<tt class="docutils literal"><span class="pre">gitgithub/helloworld</span></tt>版本库后，各自在本地执行了一次或多次提交。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-commit.png"><img alt="../images/workflow-commit.png" src="../images/workflow-commit.png" /></a>
<p class="caption">图4-20：在本地版本库中的提交</p>
</div>
<p>三个用户各自的提交都会非常顺利，但是一旦决定将本地提交推送到共享服务器时就可能遇到麻烦。用户 gotgithub 先执行推送，会非常顺利。如图4-21所示。</p>
<div class="highlight-python"><pre>gotgithub$ git push</pre>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-commit-push.png"><img alt="../images/workflow-commit-push.png" src="../images/workflow-commit-push.png" /></a>
<p class="caption">图4-21：用户gotgithub完成推送</p>
</div>
<p>而其他人就没有这么幸运了，会报告错误：遇到非快进式推送。Git的推送操作就像SVN等集中式版本控制系统的提交操作那样，先执行者成功，后执行者糟糕（要解决冲突，自动或手动）。</p>
</div>
<div class="section" id="merge-and-push">
<span id="id4"></span><h2>4.2.3. 合并后推送<a class="headerlink" href="#merge-and-push" title="永久链接至标题">¶</a></h2>
<p>当用户gotgithub完成推送后，共享版本库以及三个用户的本地版本库如图4-21所示。其中共享版本库变得和gotgithub用户的本地版本库相一致。此时如果用户supergirl执行推送，会遇到错误：非快进式推送。</p>
<div class="highlight-python"><pre>supergirl$ git push
To https://supergirl@github.com/gotgithub/helloworld.git
 ! [rejected]        master -&gt; master (non-fast-forward)
error: failed to push some refs to 'https://supergirl@github.com/gotgithub/helloworld.git'
To prevent you from losing history, non-fast-forward updates were rejected
Merge the remote changes (e.g. 'git pull') before pushing again.  See the
'Note about fast-forwards' section of 'git push --help' for details.</pre>
</div>
<p>GitHub并不对强制推送进行限制，但是用户supergirl不要用<tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">-f</span></tt>命令强制推送，因为那样会覆盖掉共享版本库中用户gotgithub的推送，正确的做法是获取共享版本库中新提交，并在本地版本库中和本地提交合并。即执行：</p>
<div class="highlight-python"><pre>supergirl$ git fetch
supergirl$ git merge</pre>
</div>
<p>获取和合并操作过程如图4-22所示。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-fetch-merge.png"><img alt="../images/workflow-fetch-merge.png" src="../images/workflow-fetch-merge.png" /></a>
<p class="caption">图4-22：合并操作示意图</p>
</div>
<p>实际上用户supergirl只需执行一条命令便可完成所有的操作：</p>
<div class="highlight-python"><pre>supergirl$ git pull</pre>
</div>
<p>即：<tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">=</span> <span class="pre">git</span> <span class="pre">fetch</span> <span class="pre">+</span> <span class="pre">git</span> <span class="pre">merge</span></tt>。</p>
<p>但是合并操作并不总是会成功，如果自动合并失败，会在暂存区对合并前后文件进行标识，工作区进入冲突解决状态，在冲突解决完成之前不能提交。Git支持多种图形工具帮助完成冲突解决，执行如下命令，即可自动调用已安装的冲突解决工具。</p>
<div class="highlight-python"><pre>supergirl$ git mergetool</pre>
</div>
<p>冲突解决完毕，执行提交即完成冲突解决。如果在冲突解决过程把本地文件搞得一团糟，随时可以取消合并操作。执行命令<tt class="docutils literal"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span></tt>会取消冲突的合并让本地版本库回到合并之前的状态。</p>
<p>成功完成合并后将本地版本库中的提交推送到共享版本库：</p>
<div class="highlight-python"><pre>supergirl$ git push</pre>
</div>
<p>完成推送后的版本库示意图如图4-23所示。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-merge-push.png"><img alt="../images/workflow-merge-push.png" src="../images/workflow-merge-push.png" /></a>
<p class="caption">图4-23：完成合并后推送</p>
</div>
</div>
<div class="section" id="rebase-and-push">
<span id="id5"></span><h2>4.2.4. 合并还是变基<a class="headerlink" href="#rebase-and-push" title="永久链接至标题">¶</a></h2>
<p>合并并非多个开发者的工作成果融合的唯一选择，有时甚至并非最佳选择。一方面合并会产生除了合并双方（或多方）所有提交外的一个新提交，增加了代码审核的负担，另一方面本地多个提交混杂一起与远程分支合并会更困难。在特定情况下，变基是合并之外的另一个选择。</p>
<p>图4-24展示用户incredible采用合并和变基两种不同解决方案的操作结果。图中右上是合并操作后的结果，右下是变基操作后的结果。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-merge-or-rebase.png"><img alt="../images/workflow-merge-or-rebase.png" src="../images/workflow-merge-or-rebase.png" /></a>
<p class="caption">图4-24：合并和变基结果比较</p>
</div>
<p>若用户 incredible 选择变基操作，执行命令如下：</p>
<ul>
<li><p class="first">获取远程版本库的提交到本地的远程分支。</p>
<div class="highlight-python"><pre>incredible$ git fetch origin</pre>
</div>
</li>
<li><p class="first">执行变基操作，将本地<tt class="docutils literal"><span class="pre">master</span></tt>分支的提交变基到新的远程分支中。</p>
<div class="highlight-python"><pre>incredible$ git rebase origin/master</pre>
</div>
</li>
</ul>
<p>如果一切顺利，变基后推送到共享版本库。</p>
<div class="highlight-python"><pre>incredible$ git push</pre>
</div>
<p>推送后的版本库状态如图4-25所示。</p>
<div class="figure">
<a class="reference internal image-reference" href="../images/workflow-rebase-push.png"><img alt="../images/workflow-rebase-push.png" src="../images/workflow-rebase-push.png" /></a>
<p class="caption">图4-25：变基后推送</p>
</div>
<p>如果希望在执行<tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>时自动使用<tt class="docutils literal"><span class="pre">git</span> <span class="pre">rebase</span></tt>取代默认的<tt class="docutils literal"><span class="pre">git</span> <span class="pre">merge</span></tt>操作，可以在<tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>命令行添加参数<tt class="docutils literal"><span class="pre">--rebase</span></tt>如下：</p>
<div class="highlight-python"><pre>$ git pull --rebase</pre>
</div>
<p>或者通过配置变量设置当前分支使用变基策略，即每次执行<tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>命令时对于<tt class="docutils literal"><span class="pre">master</span></tt>分支，采用变基操作取代默认的合并操作。</p>
<div class="highlight-python"><pre>$ git config branch.master.rebase true</pre>
</div>
<p>如果希望本地所有克隆版本库在执行<tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>时都改变默认行为，将变基作为首选，则如下设置全局变量。</p>
<div class="highlight-python"><pre>$ git config --global branch.autosetuprebase true</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="030-organization.html" title="4.3. 组织和团队"
             >下一页</a> |</li>
        <li class="right" >
          <a href="010-fork-and-pull.html" title="4.1. Fork + Pull模式"
             >上一页</a> |</li>
        <li><a href="../index.html">GotGitHub</a> &raquo;</li>
          <li><a href="index.html" >4. 工作协同</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
      <br />
      全部内容以 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons 署名-非商业性使用-相同方式共享 3.0 协议发布</a>.
      <br />
        &copy; Copyright 2011, 蒋鑫。
      最后更新于 2012/06/08。
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2 创建。

    </div>
  </body>
</html>